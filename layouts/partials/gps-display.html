{{/* Chercher un fichier polyline.json dans les ressources de la page */}}
{{ $polylineJson := .Resources.GetMatch "*.polyline.json" }}

{{ if $polylineJson }}
<br>
<div class="gps-container">
    {{/* Carte Leaflet */}}
    {{ $mapId := printf "map-%s" .File.UniqueID }}
    <div id="{{ $mapId }}" class="adventure-map"></div>
    
    {{/* Graphique d'élévation */}}
    {{ $chartId := printf "elevation-%s" .File.UniqueID }}
    <div id="{{ $chartId }}" class="elevation-chart"></div>
    
    {{/* Métadonnées de l'aventure */}}
    <div class="level" style="margin-top: 1.5rem;">
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Distance</p>
                <p class="subtitle" id="adventure-distance">--</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Durée</p>
                <p class="subtitle" id="adventure-duration">--</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Dénivelé</p>
                <p class="subtitle" id="adventure-elevation">--</p>
            </div>
        </div>
        <div class="level-item has-text-centered">
            <div>
                <p class="heading">Vitesse</p>
                <p class="subtitle" id="adventure-speed">--</p>
            </div>
        </div>
    </div>
    
    {{/* Script d'initialisation de la carte */}}
    <script>
        (function() {
            // Attendre que toutes les librairies soient chargées
            function waitForLibraries(callback) {
                if (typeof L !== 'undefined' && 
                    typeof uPlot !== 'undefined' && 
                    typeof window.initializeAdventureMap !== 'undefined') {
                    callback();
                } else {
                    setTimeout(function() { waitForLibraries(callback); }, 50);
                }
            }
            
            waitForLibraries(function() {
                window.initializeAdventureMap(
                    '{{ $mapId }}',
                    '{{ $chartId }}',
                    '{{ $polylineJson.RelPermalink }}'
                );
            });
        })();
    </script>
</div>
<hr>
{{ else }}
    <br>
{{ end }}